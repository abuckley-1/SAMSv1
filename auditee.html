<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAMS v1 | Auditee Response Portal</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="auditee-body" onload="loadAuditeeTask()">
    <header class="auditee-nav">
        <div class="header-container">
            <div class="logo">SUPERTRAM <span class="sub-logo">Compliance Portal</span></div>
            <div id="task-ref" class="ref-tag">ST0096/LOADING/2026</div>
        </div>
    </header>

    <main>
        <div id="save-msg" class="save-banner" style="display:none;">✔️ Progress Auto-Saved to Device</div>
        
        <section class="instruction-card">
            <h3>Action Required: Internal Audit Response</h3>
            <p>Please complete all sections. Use the <strong>"Attach Evidence"</strong> button to provide SharePoint links, document references, or photo IDs for the auditor to verify.</p>
        </section>

        <form id="questionnaire-form">
            <div id="mandatory-section">
                <h2 class="section-title">Step 1: Core Compliance</h2>
                </div>

            <div id="ai-section">
                <h2 class="section-title">Step 2: Process Specific Assessment</h2>
                </div>

            <div class="submission-footer">
                <button type="button" onclick="saveProgressManual()" class="btn secondary-btn">Save Progress</button>
                <button type="button" onclick="submitTask()" class="btn primary-btn">Finalise & Submit to Auditor</button>
            </div>
        </form>
    </main>

    <div id="evidence-modal" class="modal">
        <div class="modal-content">
            <h3>Attach Evidence Sample</h3>
            <div class="form-grid">
                <label>Evidence Category:</label>
                <select id="ev-type">
                    <option value="Link">SharePoint / Cloud Link</option>
                    <option value="Doc">Procedure Reference (e.g. SOP-01)</option>
                    <option value="Photo">Photograph ID</option>
                    <option value="Record">Training / Maintenance Log</option>
                </select>
                <label>Reference or URL:</label>
                <input type="text" id="ev-ref" placeholder="Paste link or type Doc ID here...">
                <label>Notes for Auditor:</label>
                <textarea id="ev-desc" style="height:60px;"></textarea>
            </div>
            <div class="modal-btns">
                <button onclick="closeEvidence()" class="btn secondary-btn">Cancel</button>
                <button onclick="confirmEvidence()" class="btn purple-btn">Attach Evidence</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Local UI helper for Modal
        let currentTargetId = null;
        function openEvidence(id) {
            currentTargetId = id;
            document.getElementById('evidence-modal').style.display = 'flex';
        }
        function closeEvidence() {
            document.getElementById('evidence-modal').style.display = 'none';
        }
        function confirmEvidence() {
            const ref = document.getElementById('ev-ref').value;
            const desc = document.getElementById('ev-desc').value;
            const type = document.getElementById('ev-type').value;
            if(!ref) return alert("Please provide a reference or link.");
            
            const noteArea = document.getElementById(`ans-${currentTargetId}`);
            const timestamp = new Date().toLocaleTimeString();
            noteArea.value += `\n[EVIDENCE ${timestamp}] ${type}: ${ref} (${desc})`;
            
            closeEvidence();
            autoSaveAuditee();
        }
    </script>
</body>
</html>
